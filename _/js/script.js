function init(){container=document.getElementById("canvas"),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),camera.position.z=250,scene=new THREE.Scene;var a=new THREE.AmbientLight(16777215);scene.add(a);var b=new THREE.DirectionalLight(16772829,4);b.position.set(3,3,30),scene.add(b),player.init(container),env.init({container:container,stars:{max:100}}),env.stars.init(),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(document.getElementsByClassName("container")[0].clientWidth,document.getElementsByClassName("container")[0].clientHeight),container.appendChild(renderer.domElement),windowHalfX=container.firstChild.style.width.replace("px","")/2,windowHalfY=container.firstChild.style.height.replace("px","")/2,window.addEventListener("resize",onWindowResize,!1)}function animate(){requestAnimationFrame(animate),render()}function render(){gamerunning&&(player.render(),env.stars.update()),renderer.render(scene,camera)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onProgress(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(Math.round(b,2)+"% downloaded")}}function onError(a){}function distance_to_point(a,b,c,d){if(c>a)var e=c-a;else var e=a-c;if(d>b)var f=d-b;else var f=b-d;var g=f/e;return g=e+g}function f_intersects(a){camera.updateMatrixWorld(),camera.matrixWorldInverse.getInverse(camera.matrixWorld),cameraViewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),frustum.setFromMatrix(cameraViewProjectionMatrix),frustum.intersectsObject(a)}var container,camera,scene,renderer,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,gamerunning=!1;window.onload=function(){init(),animate()};var env={c:{},init:function(a){this.c=a.container,this.stars.max=a.stars.max?100:a.stars.max},stars:{object:{},max:100,s:[],init:function(){var a=new THREE.TextureLoader,b=a.load("_/textures/star.png"),c=new THREE.SpriteMaterial({map:b,color:16777215,fog:!0}),d=0;for(env.stars.object=new THREE.Group;++d<this.max;){var e=-50,f=Math.floor(Math.random()*(windowHalfX/2)-windowHalfX/4),g=Math.floor(Math.random()*(windowHalfY/2)-windowHalfY/5),h=new THREE.Sprite(c);h.position.set(f,g,e),h.scale.x=h.scale.y=2*Math.random()+.5,h.yspeed=2*Math.random()+.1,env.stars.object.add(h)}scene.add(env.stars.object)},update:function(){var a=0,b=env.stars.object.children.length;for(a=0;b>a;a++)env.stars.object.children[a].position.y-=env.stars.object.children[a].yspeed,env.stars.object.children[a].position.y<-windowHalfY&&(env.stars.object.children[a].position.y+=2*windowHalfY,env.stars.object.children[a].position.x=Math.floor(Math.random()*(windowHalfX/2)-windowHalfX/4))}}};$(document).ready(function(){$("#ins").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_ins").addClass("show")}),$("#abo").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_abo").addClass("show")}),$("#pla").on("click",function(a){a.preventDefault(),$(".sfield").fadeOut("fast",function(){$(".info").fadeOut("fast",function(){$("#canvas").fadeIn("fast",function(){gamerunning=!0,$(".info .show").removeClass("show"),$("#main").addClass("show"),$(".top").addClass("show"),$(".pandc").addClass("show")})})})})});var player={ship:{x:0,y:-80,speed:1,b:!1,object:{},cweapon:"single"},init:function(a){var b=new THREE.LoadingManager;b.onProgress=function(a,b,c){console.log(a,b,c)};var c=new THREE.Texture,d=function(a){},e=new THREE.TextureLoader,f=e.load("_/textures/thrust.png"),g=new THREE.SpriteMaterial({map:f,color:16777215,fog:!0}),h=new THREE.Sprite(g);h.position.set(0,-10,0),h.scale.x=10,h.scale.y=10;var i=new THREE.ImageLoader(b);i.load("textures/UV_Grid_Sm.jpg",function(a){c.image=a,c.needsUpdate=!0});for(var j=[],k=0;30>k;k+=10)j[k]=new THREE.PointLight(11190771,1,k),j[k].castShadow=!0,j[k].shadow.camera.near=1,j[k].shadow.camera.far=30,j[k].shadow.bias=.01;j[0].position.set(-30,0,-10),j[10].position.set(30,0,-10),j[20].position.set(-30,-30,-60);var i=new THREE.OBJLoader(b);i.load("_/models/viper.obj",function(a){player.ship.object=a,player.ship.object.traverse(function(a){a instanceof THREE.Mesh&&(a.material.map=c)}),player.ship.object.add(h),player.ship.object.add(j[0]),player.ship.object.add(j[10]),player.ship.object.add(j[20]),player.ship.object.position.z=-30,scene.add(player.ship.object)},onProgress,d),a.addEventListener("click",this.shipClick,!1)},render:function(){player.weapons.shotloop();var a=distance_to_point(this.ship.object.position.x,this.ship.object.position.y,this.ship.x,this.ship.y),b=this.ship.speed+a/1e4,c=.03;a>10?(this.ship.object.position.x<this.ship.x-b?(this.ship.object.position.x+=b,this.ship.object.rotation.y<.5&&(this.ship.object.rotation.y+=c)):this.ship.object.position.x>this.ship.x+b&&(this.ship.object.position.x-=b,this.ship.object.rotation.y>-.5&&(this.ship.object.rotation.y-=c)),this.ship.object.position.y<this.ship.y-b?this.ship.object.position.y+=b:this.ship.object.position.y>this.ship.y+b&&(this.ship.object.position.y-=b),distance_to_point(this.ship.object.position.x,this.ship.y,this.ship.x,this.ship.y)<25&&(this.ship.object.rotation.y>.02&&(this.ship.object.rotation.y-=c+.02),this.ship.object.rotation.y<-.02&&(this.ship.object.rotation.y+=c+.02))):(this.ship.object.rotation.y>.02&&(this.ship.object.rotation.y-=c),this.ship.object.rotation.y<-.02&&(this.ship.object.rotation.y+=c))},shipClick:function(a){gamerunning&&(player.ship.x=(a.clientX-windowHalfX)/2,player.ship.x>0?player.ship.x-=player.ship.x/2:player.ship.x+=Math.abs(player.ship.x)/2,player.ship.y=-((a.clientY-windowHalfY)/2),player.ship.y>0?player.ship.y-=player.ship.y/2:player.ship.y+=Math.abs(player.ship.y)/2)},weapons:{degug:!1,object:[],_single:!1,shotspeed:5,shotclock:0,firing:!0,shotloop:function(){if("undefined"!=typeof player.ship.cweapon&&(player.weapons.shotclock++,player.weapons.shotclock>player.weapons.shotspeed)){switch(player.ship.cweapon){case"single":player.weapons.single()}player.weapons.shotclock=0}player.weapons.firing&&player.weapons.update()},single:function(){if(!this._single){var a=new THREE.TextureLoader,b=a.load("_/textures/shot.png");this._single.mat=new THREE.SpriteMaterial({map:b,color:16777215,fog:!0})}var c=new THREE.Sprite(this._single.mat);c.position.set(0,0,-1),c.scale.x=2,c.scale.y=2,c.yspeed=1,player.weapons.object.push(c),scene.add(c)},update:function(){player.weapons.degug<10&&(console.log(player.weapons.object.length),player.weapons.degug++);var a=0,b=player.weapons.object.length;for(a=0;b>a;a++)player.weapons.object[a].position.y+=player.weapons.object[a].yspeed,player.weapons.object[a].position.y>windowHalfY&&player.weapons.object.splice(a,1)}}};