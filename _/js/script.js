function init(){container=document.getElementById("canvas"),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),camera.position.z=250,_frustum=new THREE.Frustum,scene=new THREE.Scene;var a=new THREE.AmbientLight(16777215);scene.add(a);var b=new THREE.DirectionalLight(16772829,4);b.position.set(3,3,30),scene.add(b),player.init(container),env.init({container:container,stars:{max:100}}),env.stars.init(),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(document.getElementsByClassName("container")[0].clientWidth,document.getElementsByClassName("container")[0].clientHeight),container.appendChild(renderer.domElement),windowHalfX=container.firstChild.style.width.replace("px","")/2,windowHalfY=container.firstChild.style.height.replace("px","")/2,window.addEventListener("resize",onWindowResize,!1),TIMELINE.init(1)}function animate(){requestAnimationFrame(animate),render()}function render(){gamerunning&&(player.render(),env.stars.update(),ENEMIES.loop(),TIMELINE.loop()),renderer.render(scene,camera)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onProgress(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(Math.round(b,2)+"% downloaded")}}function onError(a){}function distance_to_point(a,b,c,d){if(c>a)var e=c-a;else var e=a-c;if(d>b)var f=d-b;else var f=b-d;var g=f/e;return g=e+g}function point_direction(a,b,c,d,e){var f=c-a,g=d-b,h=Math.atan2(g,f),i=h*(180/Math.PI);return 0>i&&(i+=360),e?h:i}function motion_set_2(a,b){var c=a.position.x,d=a.position.y,e=a.rotation.z;return c+=Math.cos(e)*Math.PI/180*b,d+=Math.sin(e)*Math.PI/180*b,a.position.x=c,a.position.y=d,a}function motion_set_3(a,b,c,d,e){var f=new Object,g=d*(Math.PI/180);return a+=Math.cos(g)*Math.PI/180*e,b+=Math.sin(g)*Math.PI/180*e,c+=Math.sin(g)*Math.PI/180*e,f.x=a,f.y=b,f.z=c,f}function move_to_contact(a,b){var c=point_direction(a.x,a.y,b.x,b.y);c+=180;var d=15;for(a.speed>1?d=a.speed:b.speed>1&&(d=b.speed);1==checkCollision(a,b);){var e=c*(Math.PI/180);a.x+=Math.cos(e)*Math.PI/180*a.speed,a.y+=Math.sin(e)*Math.PI/180*a.speed}}function checkCollision(a,b){for(var c=new Array(a.x-a.negXcollisionBox,a.x+a.posXcollisionBox),d=new Array(a.y-a.negYcollisionBox,a.y+a.posYcollisionBox),e=0;2>e;e++)for(var f=0;2>f;f++)if(c[e]>b.x-b.negXcollisionBox&&c[e]<b.x+b.posXcollisionBox&&d[f]>b.y-b.negYcollisionBox&&d[f]<b.y+b.posYcollisionBox)return!0;return!1}function checkCollisionCoords(a,b,c,d,e){new Array(a-e,a+e),new Array(d-e,d+e);return a>c-e&&c+e>a&&b>d-e&&d+e>b}function init(){container=document.getElementById("canvas"),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),camera.position.z=250,scene=new THREE.Scene;var a=new THREE.AmbientLight(16777215);scene.add(a);var b=new THREE.DirectionalLight(16772829,2);b.position.set(0,0,10),scene.add(b);var c=new THREE.LoadingManager;c.onProgress=function(a,b,c){console.log(a,b,c)};var d=new THREE.Texture,e=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(Math.round(b,2)+"% downloaded")}},f=function(a){},g=new THREE.ImageLoader(c);g.load("textures/UV_Grid_Sm.jpg",function(a){d.image=a,d.needsUpdate=!0});var h=new THREE.PointLight(11190771,1,30);h.castShadow=!0,h.shadow.camera.near=1,h.shadow.camera.far=30,h.shadow.bias=.01,h.position.x-=30,h.position.y-=30,h.position.z-=30;var g=new THREE.OBJLoader(c);g.load("_/models/viper.obj",function(a){a.traverse(function(a){a instanceof THREE.Mesh&&(a.material.map=d)}),a.add(h),a.position.z=-30,scene.add(a)},e,f),renderer=new THREE.WebGLRenderer,renderer.setClearColor(16711680),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),container.addEventListener("click",onDocumentMouseMove,!1),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(a){gamerunning&&(ship.x=(a.clientX-windowHalfX)/2,ship.x>0?ship.x-=ship.x/2:ship.x+=Math.abs(ship.x)/2,ship.y=-((a.clientY-windowHalfY)/2),ship.y>0?ship.y-=ship.y/2:ship.y+=Math.abs(ship.y)/2)}function animate(){requestAnimationFrame(animate),render()}function render(){if("undefined"!=typeof scene.children[2]&&gamerunning){var a=scene.children[2],b=distance_to_point(a.position.x,a.position.y,ship.x,ship.y),c=ship.speed+b/1e4,d=.03;b>10?(a.position.x<ship.x-c?(a.position.x+=c,a.rotation.y<.5&&(a.rotation.y+=d)):a.position.x>ship.x+c&&(a.position.x-=c,a.rotation.y>-.5&&(a.rotation.y-=d)),a.position.y<ship.y-c?a.position.y+=c:a.position.y>ship.y+c&&(a.position.y-=c),distance_to_point(a.position.x,ship.y,ship.x,ship.y)<25&&(a.rotation.y>.02&&(a.rotation.y-=d+.02),a.rotation.y<-.02&&(a.rotation.y+=d+.02))):(a.rotation.y>.02&&(a.rotation.y-=d),a.rotation.y<-.02&&(a.rotation.y+=d))}renderer.render(scene,camera)}function distance_to_point(a,b,c,d){if(c>a)var e=c-a;else var e=a-c;if(d>b)var f=d-b;else var f=b-d;var g=f/e;return g=e+g}function f_intersects(a){camera.updateMatrixWorld(),camera.matrixWorldInverse.getInverse(camera.matrixWorld),cameraViewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),frustum.setFromMatrix(cameraViewProjectionMatrix),frustum.intersectsObject(a)}function removeEntity(a,b,c){var d=scene.getObjectByName(a.name);scene.remove(d),toEnd(b,c),animate()}function toEnd(a,b){return a.push(a.splice(b,1)),a}function TextureAnimator(a,b,c,d,e){this.tilesHorizontal=b,this.tilesVertical=c,this.numberOfTiles=d,a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=e,this.currentDisplayTime=0,this.currentTile=0,this.update=function(b){for(this.currentDisplayTime+=b;this.currentDisplayTime>this.tileDisplayDuration;){this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0);var c=this.currentTile%this.tilesHorizontal;a.offset.x=c/this.tilesHorizontal;var d=Math.floor(this.currentTile/this.tilesHorizontal);a.offset.y=d/this.tilesVertical}}}var container,camera,scene,renderer,_frustum,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,gamerunning=!1;window.onload=function(){init(),animate()};var ENEMIES={e:{},c:0,test:!0,loadmodel:function(a,b){var c=new THREE.MTLLoader;c.load("_/models/"+a+".mtl",function(c){c.preload();var d=new THREE.OBJLoader;d.setMaterials(c),d.load("_/models/"+a+".obj",function(a){b(a)},onProgress,onError)})},loop:function(){var a=0;for(var b in this.e)this.e[b].loop(a),a++},addDebugpathNodes:function(a){for(var b=a.length,c=new THREE.MeshBasicMaterial({color:16777215}),d=0;b>d;d++){var e=new THREE.BoxGeometry(10,10,10),f=new THREE.Mesh(e,c);f.position.x=a[d].c[0],f.position.y=a[d].c[1],scene.add(f)}},turn:function(a,b,c,d,e){var f=point_direction(a.position.x,a.position.y,b,c,!1);"variant"==d&&(d=Math.abs(Math.abs(b)-f));var g=Math.degrees(a.rotation.z);return g>=180&&360-f>180?(f>g-10&&(g-=d),g+10>f&&(g+=d)):(f>g-10&&(g+=d),g+10>f&&(g-=d)),a=this.roll(a,g,f,d,e),0>g&&(g=360),g>360&&(g=0),a.rotation.z=Math.radians(g),a},roll:function(a,b,c,d,e){if(Math.degrees(a.rotation.y)>=e)return a;var f=Math.abs(Math.degrees(a.rotation.y));return Math.abs(b)-Math.abs(c)>10?e>f&&(f+=d):f>0&&(f-=d),a.rotation.y<0&&(f=-f),a.rotation.y=Math.radians(f),a},remove:function(a){var b=scene.getObjectByName(a);scene.remove(b),delete ENEMIES.e[a]}},env={c:{},init:function(a){this.c=a.container,this.stars.max=a.stars.max?100:a.stars.max},stars:{object:{},max:100,s:[],init:function(){var a=new THREE.TextureLoader,b=a.load("_/textures/star.png"),c=new THREE.SpriteMaterial({map:b,color:16777215,fog:!0}),d=0;for(env.stars.object=new THREE.Group;++d<this.max;){var e=-50,f=Math.floor(Math.random()*(windowHalfX/2)-windowHalfX/4),g=Math.floor(Math.random()*(windowHalfY/2)-windowHalfY/5),h=new THREE.Sprite(c);h.position.set(f,g,e),h.scale.x=h.scale.y=2*Math.random()+.5,h.yspeed=2*Math.random()+.1,env.stars.object.add(h)}scene.add(env.stars.object)},update:function(){var a=0,b=env.stars.object.children.length;for(a=0;b>a;a++)env.stars.object.children[a].position.y-=env.stars.object.children[a].yspeed,env.stars.object.children[a].position.y<-windowHalfY&&(env.stars.object.children[a].position.y+=2*windowHalfY,env.stars.object.children[a].position.x=Math.floor(Math.random()*(windowHalfX/2)-windowHalfX/4))}}};$(document).ready(function(){$("#ins").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_ins").addClass("show")}),$("#abo").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_abo").addClass("show")}),$("#pla").on("click",function(a){a.preventDefault(),$(".sfield").fadeOut("fast",function(){$(".info").fadeOut("fast",function(){$("#canvas").fadeIn("fast",function(){gamerunning=!0,$(".info .show").removeClass("show"),$("#main").addClass("show"),$(".top").addClass("show"),$(".pandc").addClass("show")})})})})}),Math.radians=function(a){return a*Math.PI/180},Math.degrees=function(a){return 180*a/Math.PI},Math.sqr=function(a){return a*a};var player={ship:{x:0,y:-80,speed:1,b:!1,object:{},cweapon:"single"},init:function(a){var b=new THREE.LoadingManager;b.onProgress=function(a,b,c){console.log(a,b,c)};var c=new THREE.Texture,d=function(a){},e=new THREE.TextureLoader,f=e.load("_/textures/thrust.png"),g=new THREE.SpriteMaterial({map:f,color:16777215,fog:!0}),h=new THREE.Sprite(g);h.position.set(0,-10,0),h.scale.x=10,h.scale.y=10;var i=new THREE.ImageLoader(b);i.load("_/textures/viper.png",function(a){c.image=a,c.needsUpdate=!0});for(var j=[],k=0;30>k;k+=10)j[k]=new THREE.PointLight(11190771,1,k),j[k].castShadow=!0,j[k].shadow.camera.near=1,j[k].shadow.camera.far=30,j[k].shadow.bias=.01;j[0].position.set(-30,0,-10),j[10].position.set(30,0,-10),j[20].position.set(-30,-30,-60);var i=new THREE.OBJLoader(b);i.load("_/models/viper.obj",function(a){player.ship.object=a,player.ship.object.traverse(function(a){a instanceof THREE.Mesh&&(a.material.map=c)}),player.ship.object.castShadow=!0,player.ship.object.receiveShadow=!0,player.ship.object.add(h),player.ship.object.add(j[0]),player.ship.object.add(j[10]),player.ship.object.add(j[20]),player.ship.object.position.z=-30,scene.add(player.ship.object),player.weapons.single.init()},onProgress,d),a.addEventListener("click",this.shipClick,!1)},render:function(){player.weapons.shotloop();var a=distance_to_point(this.ship.object.position.x,this.ship.object.position.y,this.ship.x,this.ship.y),b=this.ship.speed+a/1e4,c=.03;a>10?(this.ship.object.position.x<this.ship.x-b?(this.ship.object.position.x+=b,this.ship.object.rotation.y<.5&&(this.ship.object.rotation.y+=c)):this.ship.object.position.x>this.ship.x+b&&(this.ship.object.position.x-=b,this.ship.object.rotation.y>-.5&&(this.ship.object.rotation.y-=c)),this.ship.object.position.y<this.ship.y-b?this.ship.object.position.y+=b:this.ship.object.position.y>this.ship.y+b&&(this.ship.object.position.y-=b),distance_to_point(this.ship.object.position.x,this.ship.y,this.ship.x,this.ship.y)<25&&(this.ship.object.rotation.y>.02&&(this.ship.object.rotation.y-=c+.02),this.ship.object.rotation.y<-.02&&(this.ship.object.rotation.y+=c+.02))):(this.ship.object.rotation.y>.02&&(this.ship.object.rotation.y-=c),this.ship.object.rotation.y<-.02&&(this.ship.object.rotation.y+=c))},shipClick:function(a){if(gamerunning){var b=1.5;windowHalfX>250&&(b=2),player.ship.x=(a.clientX-windowHalfX)/b,player.ship.x>0?player.ship.x-=player.ship.x/2:player.ship.x+=Math.abs(player.ship.x)/2,player.ship.y=-((a.clientY-windowHalfY)/2),player.ship.y>0?player.ship.y-=player.ship.y/2:player.ship.y+=Math.abs(player.ship.y)/2}},weapons:{degug:!1,object:[],_single:!1,firing:!0,i:0,shotloop:function(){switch(player.ship.cweapon){case"single":player.weapons.single.update()}},single:{i:0,clock:20,max:20,_single:[],init:function(){for(var a=0;a<this.max;a++){var b=new THREE.TextureLoader,c=b.load("_/textures/shot.png"),d=new THREE.SpriteMaterial({map:c,color:16777215,fog:!0}),e=new THREE.Sprite(d);e.position.set(player.ship.object.position.x,player.ship.object.position.y+10,-1),e.scale.x=2,e.scale.y=4,e.yspeed=1,e.visible=!1,this._single.push(e),scene.add(e)}},shoot:function(){if(this.i++,this.i>=this.clock)for(var a=0;a<this.max;a++)0==player.weapons.single._single[a].visible&&(this._single[a].position.x=player.ship.object.position.x-player.ship.object.position.x/10,this._single[a].position.y=player.ship.object.position.y+10,player.weapons.single._single[a].visible=!0,a=this.max,this.i=0)},update:function(){this.shoot();for(var a=0;a<this.max;a++)this._single[a].position.y>100?this._single[a].visible=!1:this._single[a].visible&&(this._single[a].position.y+=this._single[a].yspeed)}},update:function(){player.weapons.object.length;player.weapons.i++}}};$(document).ready(function(){$("#ins").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_ins").addClass("show")}),$("#abo").on("click",function(a){a.preventDefault(),$(".info .show").removeClass("show"),$("#_abo").addClass("show")}),$("#pla").on("click",function(a){a.preventDefault(),$(".sfield").fadeOut("fast",function(){$(".info").fadeOut("fast",function(){$("#canvas").fadeIn("fast",function(){gamerunning=!0,$(".info .show").removeClass("show"),$("#main").addClass("show"),$(".top").addClass("show"),$(".pandc").addClass("show")})})})})});var container,camera,scene,renderer,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,ship={x:0,y:-80,speed:1,b:!1},gamerunning=!1;window.onload=function(){init(),animate()};var TIMELINE={clock:0,level:1,init:function(a){this.level=a,this.clock=0},loop:function(){switch(this.clock++,this.level){case 1:this.level_1()}},level_1:function(){switch(this.clock){case 100:ENEMIES.loadmodel("turtle3",function(a){for(var b=0;200>b;b+=40)ENEMIES.c++,ENEMIES.e["turtle"+ENEMIES.c]=new ENEMIES.turtle(-40,120+b,270,0,a,ENEMIES.c)})}}};ENEMIES.turtle=function(a,b,c,d,e,f){this.c=f;var g=1.5;this.speed=65,this.tspeed=2,this.tl=TIMELINE.clock,this.clock=0,this.a_pp=d,this.l=this.a_p[this.a_pp].length,this.g=new THREE.Group,this.g.position.x=a,this.g.position.y=b,this.g.rotation.z=Math.radians(c),this.g.scale.x=g,this.g.scale.y=g,this.g.scale.z=g,this.g.name="turtle"+f,e.name="turtle"+f,this.g.add(e.clone()),scene.add(this.g)},ENEMIES.turtle.prototype={constructor:ENEMIES.turtle,a_p:[[{t:1500,c:[-40,0]},{t:1500,c:[71,73]},{t:2550,c:[60,80]},{t:2550,c:[60,-200]}],[{t:15,c:[1,1]}]],now:0,loop:function(a){this.g=ENEMIES.turn(this.g,this.a_p[this.a_pp][this.now].c[0],this.a_p[this.a_pp][this.now].c[1],this.tspeed,65),this.g=motion_set_2(this.g,this.speed),checkCollisionCoords(this.g.position.x,this.g.position.y,this.a_p[this.a_pp][this.now].c[0],this.a_p[this.a_pp][this.now].c[1],10)&&(this.now<this.l-1?this.now++:this.die(!1))},die:function(a){a&&(this.gold||this.gold_c)&&ENEMIES.create_pup(this.g.position.x,this.g.position.y),ENEMIES.remove("turtle"+this.c)}};